{% extends "base.html" %}
{% block title %}
    {{ context.title }}
{% endblock %}

{% block page_content %}

    {% block content %}
        <link href="{{ url_for('static', filename='css/home.css') }}" rel="stylesheet">
        <div class="container">
            <div class="page-header">
                <div class="row">
                    <div class="col-md-10">
                        <h3>
                            <a href="/">
                                <img class="icon" src="{{ url_for('static', filename='icons/025-home.png') }}">
                            </a>
                            ABB Recorders:{{ context.total }}
                        </h3>
                    </div>
                    <div class="col-md-2 refresh_count" id="countdown">&nbsp;</div>
                </div>
                <div class="jumbotron tabletext">

                    <table class="table table-striped">
                        <thead>
                        <tr scope="row">
                            <th scope="col-6">Plant/Site</th>
                            <th scope="col-2">Orders</th>
                            <th scope="col-2">Flow</th>
                            <th scope="col-1">&nbsp;</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for row in context.data %}
                            <tr scope="row">
                                <td scope="col-6">
                                    <a href="{{ row['url'] }}">{{ row['dispname'] }}</a>
{#                                    <span id="{{ loop.index }}A" class="dyn-icon">{{ row['orders_vs_flow'] }}</span>#}
                                </td>
                                <td scope="col-2">
                                    <a href="{{ row['url'] }}">{{ row['orders'] }}</a>
                                </td>
                                <td scope="col-2">
                                    <a href="{{ row['url'] }}">{{ row['flowfmt'] }}</a>
                                </td>
                                <td scope="col-1">
                                    <span id="{{ loop.index }}B" class="dyn-icon">{{ row['orders_vs_flow'] }}</span>
                                </td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
                <hr>
                <div><i>Data Format:<br>Lateral, followed by ordered CFS, followed by ABB Flow in CFS.</i></div>
            </div>
            <hr>
            {% include 'footer.html' %}
        </div>

        <script type="text/javascript" src="{{ url_for('static', filename='js/includes.js') }}"></script>
        <script type="text/javascript">
            // document.onload = startup();
            // Reload page every 60 seconds.
            // setTimeout(function () { startup(); }, 60000);
            // timerHandler();

            {#                        {% set icon = '' %}#}
            {#                        {% if row['orders_vs_flow'] > '' %}#}
            {#                            {% if row['orders_vs_flow'] == 'good' %}#}
            {#                                {% set icon = Markup('<img class="icon" src="' + url_for('static', filename='icons/011-check.png') + '">') %}#}
            {#                            {% else %}#}
            {#                                {% set icon = Markup('<img class="icon" src="' + url_for('static', filename='icons/035-notification.png') + '">') %}#}
            {#                            {% endif %}#}
            {#                        {% endif %}#}

            let good_path = "{{ url_for('static', filename = 'icons/011-check.png') }}";
            let bad_path = "{{ url_for('static', filename = 'icons/035-notification.png') }}";

            function icon(id, value) {
                if (value == '') {
                    icon_remove(id)
                } else if (value == 'good') {
                    icon_set(id, good_path)
                } else {
                    icon_set(id, bad_path)
                }
            }

            function icon_remove(id) {
                document.getElementById(id).innerHTML = ''
            }

            function icon_set(id, path) {
                let html = '<img class="icon" src="' + path + '">';
                document.getElementById(id).innerHTML = html
            }

            function startup() {
                let items = document.getElementsByClassName('dyn-icon')
                for (let i in items) {
                    let id = items[i].id
                    if (id != null) {
                        let txt = items[i].innerText.trim()

                        switch (txt) {
                            case 'good':
                                icon_set(id, good_path);
                                break;
                            case 'error':
                                icon_set(id, bad_path);
                                break;
                            default:
                                icon_remove(id);
                                break;
                        }
                    }
                }
            }

            document.onload = startup();

        </script>

    {% endblock %}

{% endblock %}
